spring:
  application:
    name: smartcampost-backend

  datasource:
    # SECURITY: Use environment variables for database credentials in production
    url: ${DATABASE_URL:jdbc:mysql://localhost:3306/smartcampost?useSSL=true&requireSSL=true&allowPublicKeyRetrieval=false&serverTimezone=Africa/Douala}
    username: ${DATABASE_USERNAME:root}
    password: ${DATABASE_PASSWORD:}
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      pool-name: SmartPool
      # SECURITY: Connection timeout
      connection-timeout: 30000
      # SECURITY: Leak detection
      leak-detection-threshold: 60000

  jpa:
    hibernate:
      ddl-auto: ${JPA_DDL_AUTO:validate}  # Use "validate" in production, "update" only in dev
    properties:
      hibernate:
        format_sql: false  # Disable in production
    show-sql: ${SHOW_SQL:false}  # SECURITY: Disable SQL logging in production

  ai:
    openai:
      # SECURITY: API key from environment variable only
      api-key: ${OPENAI_API_KEY:}

server:
  port: ${PORT:8080}
  # SECURITY: Error handling
  error:
    include-message: never
    include-stacktrace: never
    include-binding-errors: never

# SECURITY: MTN Mobile Money credentials from environment variables only
mtn:
  consumer-key: ${MTN_CONSUMER_KEY:}
  consumer-secret: ${MTN_CONSUMER_SECRET:}
  token-url: ${MTN_TOKEN_URL:http://localhost:9200/token}
  init-url: ${MTN_INIT_URL:http://localhost:9200/init}

# SmartCAMPOST Security Configuration
smartcampost:
  # JWT Configuration - MUST be set in production
  jwt:
    secret: ${SMARTCAMPOST_JWT_SECRET:}
    expiration-hours: ${JWT_EXPIRATION_HOURS:8}

  # Default Admin Bootstrap - Creates admin on first startup
  # SECURITY: Remove password from config after first use in production!
  bootstrap:
    default-admin:
      phone: ${ADMIN_PHONE:+237690000000}
      password: ${ADMIN_PASSWORD:Admin@SmartCAMPOST2026}
      full-name: ${ADMIN_FULLNAME:SmartCAMPOST Administrator}
      email: ${ADMIN_EMAIL:admin@smartcampost.cm}

  ai:
    system-prompt: ${SMARTCAMPOST_AI_SYSTEM_PROMPT:You are SmartCAMPOST AI, the official intelligent assistant of Cameroon Postal Services. You help users track parcels, understand delivery timelines, resolve issues, manage pickups, payments, and accounts. Be concise, accurate, friendly, and professional. If data is missing, ask clarifying questions. Never hallucinate parcel statuses or user data. When relevant, guide users step-by-step.}
  
  otp:
    # SECURITY: Never expose OTP in production responses
    expose-code-in-response: ${SMARTCAMPOST_OTP_EXPOSE_CODE:false}

  qr:
    # SECURITY: QR secret key from environment variable only
    secret-key: ${QR_SECRET_KEY:}
    max-verifications-per-hour: ${QR_MAX_VERIFICATIONS:100}
    temporary-validity-hours: ${QR_TEMP_VALIDITY_HOURS:48}

  security:
    rate-limit:
      enabled: ${RATE_LIMIT_ENABLED:true}
      requests-per-minute: ${RATE_LIMIT_RPM:60}
      auth-requests-per-minute: ${AUTH_RATE_LIMIT_RPM:10}

  selfhealing:
    congestion-threshold: 50
    high-congestion-level: 0.8
    critical-congestion-level: 0.95
    notification-interval-minutes: 30

  ussd:
    session-timeout-minutes: 5
    max-menu-depth: 5

  gps:
    mandatory: true
    max-accuracy-meters: 100

  offline:
    max-queue-size: 100
    auto-sync: true

# SECURITY: Logging configuration for production
logging:
  level:
    root: ${LOG_LEVEL:INFO}
    org.hibernate.SQL: ${SQL_LOG_LEVEL:ERROR}
    org.hibernate.type.descriptor.sql: ERROR
    com.smartcampost: ${APP_LOG_LEVEL:INFO}
  # SECURITY: Don't log sensitive data
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
